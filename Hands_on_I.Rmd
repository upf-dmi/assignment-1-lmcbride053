---
title: "Albert y Liam First Assignment"
author: "Liam McBride (liam.mcbride01@estudiant.upf.com)"
date: "Last update: `r format(Sys.time(), '%d %B, %Y')`"      
output:
  html_document:
    toc: true
    fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(stats)
library(DataExplorer)
library(outliers)
```


# Analysis of the Heart Disease Dataset 
Load the data from
[here](https://raw.githubusercontent.com/jpinero/DMI_2021/main/datasets/heart_disease_dataset.csv), and the description is [here](https://raw.githubusercontent.com/jpinero/DMI_2021/main/datasets/heart_disease_description.txt). 
The original dataset comes from [here](https://archive.ics.uci.edu/ml/datasets/Heart+Disease) and corresponds to the [processed cleveland data](https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data)

## Perform an EDA on the dataset

### Reading in the Data
```{r}
hdisease <- read.table("./data/heart_disease_dataset.csv", header=T)
```

### Transforming the data to ensure categorical and numerical variables are treated as such

```{r}
hdisease1 <- hdisease %>%
  mutate(
    sex = ifelse(sex == 1, "male", "female"),
    cp = recode(cp, `1` = "typical angina", `2` = "atypical angina", `3` = "non-anginal pain", `4` = "asymptomatic"),
    fbs = ifelse(fbs == 1, T, F ),
    restecg = recode(restecg, `1` = "abnormal", `2` = "probable hypertrophy", `0` = "normal"),
    exang = ifelse(exang == 1, "yes", "no"),
    slope = recode(slope, `1` = "upsloping", `2` = "flat", `3` = "downsloping"),
    thal = recode(thal, `3` = "normal", `6` = "fixed defect", `7` = "reversible defect"),
    num = ifelse(num == 0, "negative diagnosis", "positive diagnosis")
  )
hdisease1[hdisease1 == "?"] <- NA

is_numeric <- sapply(hdisease1, is.numeric)
min_percentile_thresholds <- numeric(sum(is_numeric))
max_percentile_thresholds <- numeric(sum(is_numeric))
# Loop through each numeric column to detect and replace outliers
for (i in which(is_numeric)) {
  column_data <- hdisease1[[i]]
  min_percentile_thresholds[i] <- quantile(hdisease1[[i]], 0.05, na.rm = TRUE)  # 5th percentile
  max_percentile_thresholds[i] <- quantile(hdisease1[[i]], 0.95, na.rm = TRUE)  # 95th percentile
  hdisease1[[i]][column_data < min_percentile_thresholds[i]] <- min_percentile_thresholds[i] 
  hdisease1[[i]][column_data > max_percentile_thresholds[i]] <- max_percentile_thresholds[i]
}

```

### Summary of the data
```{r}
summary(hdisease1)
```
### Age distribution
```{r}
ggplot(hdisease1, aes(x=age)) +
  geom_histogram()
```

```{r}
plot_missing(hdisease1)
```

### Distributions of numerical variables
```{r}
numeric_vars <- hdisease1 %>%
  select_if(is.numeric) %>%
  select(!patient_id)

# Plot histograms for selected variables
numeric_vars %>%
  gather(key = "variable", value = "value") %>%
  ggplot(aes(x = value)) +
  geom_histogram(bins = 10, fill = "blue", color = "black", alpha = 0.7) +
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Histograms of Numerical Variables", x = "Value", y = "Frequency")
```

```{r}
numeric_vars %>%
  gather(key = "variable", value = "value") %>%
  ggplot(aes(x = value)) +
  geom_boxplot() +
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Boxplots of Numerical Variables", x = "Value", y = "Frequency")
```

### Distributions of categorical variables
```{r}
# Select categorical variables
categorical_vars <- hdisease1 %>%
  select_if(function(col) is.character(col) || is.logical(col))

# Convert the categorical variables to long format for plotting
categorical_vars_long <- categorical_vars %>%
  gather(key = "variable", value = "value")

# Plot bar charts for categorical variables
categorical_vars_long %>%
  ggplot(aes(x = value)) +
  geom_bar(fill = "blue", color = "black", alpha = 0.7) +
  facet_wrap(~ variable, scales = "free_x") +
  theme_minimal() +
  labs(title = "Bar Charts of Categorical Variables", x = "Category", y = "Count")

categorical_vars_long %>%
  gather(key = "variable", value = "value") %>%
  count(variable, value) %>%
  arrange(variable, desc(n))
```


## Create visualizations in order to show which variables seem to be more associated with heart disease

```{r}

```


# 2 Difference in mortality rates in hospitalized COVID-19 patients 
Using the supplementary material from the [Difference in mortality rates in hospitalized COVID-19 patients identified by cytokine profile clustering using a machine learning approach: An outcome prediction alternative](https://www.frontiersin.org/articles/10.3389/fmed.2022.987182/full), perform the following tasks

## Reproduce Figure 1 from the publication

```{r}

```


## Reproduce Figure 2 from the publication
but instead of representing the clusters in the annotation, represent the groups (G1 to G4)

```{r}

```

## Improve figure 2 of the publication
Add a second annotation with information of deathm and a third one with information of gender

```{r}

```


# session info {.unnumbered}

```{r, results='asis',  echo=FALSE, message=FALSE }
sessionInfo()
```
